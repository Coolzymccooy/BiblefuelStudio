import{c as O,h as de,r as t,j as e,B as x,b as m,z as r,I as xe}from"./index-2zSl8dPB.js";import{C as y}from"./Card-BZBWq0kh.js";import{I as B}from"./Input-BZbQ3akf.js";import{a as F,S as Z}from"./sparkles-CXeLJeeR.js";import{L as J}from"./library-Bs23YTBu.js";import{D as U}from"./download-mTARBAdP.js";import{P as me}from"./play-CBGZ8sX5.js";import{T as pe}from"./trash-2-W8qxl8L6.js";import{E as he}from"./external-link-5pbTvahs.js";const ue=[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]],fe=O("bookmark",ue);const ge=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}],["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"m9 13 3-3 3 3",key:"1pxg3c"}]],be=O("folder-up",ge);function V(l){return String(l||"").replace(/\\/g,"/").trim()}function ye(l){return/\.(mp4|mov|webm|m4v)(\?|#|$)/i.test(String(l||""))}function we(l){const i=V(l.previewUrl||l.url);if(!i||i.startsWith("http://")||i.startsWith("https://"))return"";const o=(i.split("/").pop()||"").replace(/\.[^.]+$/,"");return o?`/outputs/${o}.jpg`:""}function je({video:l}){const i=V(l.image),n=we(l),o=V(l.previewUrl||l.url),p=!!o&&ye(o),[f,w]=t.useState(i||n),[g,k]=t.useState(!1),[S,u]=t.useState(!1);t.useEffect(()=>{w(i||n),k(!1),u(!1)},[l.id,i,n,l.previewUrl,l.url]);const b=()=>{if(!g&&n&&f!==n){w(n),k(!0);return}w("")};return e.jsxs("div",{className:"w-full h-full bg-black relative",onMouseEnter:()=>{p&&u(!0)},onMouseLeave:()=>u(!1),onClick:()=>{p&&u(P=>!P)},children:[f?e.jsx("img",{src:f,className:"w-full h-full object-cover opacity-85 group-hover:opacity-100 transition-opacity",alt:"",loading:"lazy",onError:b}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-900",children:e.jsx(xe,{className:"text-gray-700",size:48})}),p&&S&&e.jsx("video",{src:o,className:"absolute inset-0 w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0,autoPlay:!0,preload:"metadata",onError:()=>u(!1)})]})}function $e(){const{config:l}=de(),i=l.features.pexels,n=l.features.pixabay,[o,p]=t.useState("search"),[f,w]=t.useState("sunrise clouds"),[g,k]=t.useState([]),[S,u]=t.useState("space nebula"),[b,P]=t.useState([]),[_,R]=t.useState(!1),[C,j]=t.useState([]),[M,K]=t.useState(!1),[T,Y]=t.useState(!1),[ee,q]=t.useState(!1),[ae,Q]=t.useState(!1),[$,re]=t.useState(""),[D,se]=t.useState([]),X=async()=>{if(!i){r.error("Pexels API is not configured");return}K(!0);try{const a=await m.get(`/api/pexels/search?q=${encodeURIComponent(f)}`);a.ok&&a.data?.videos?(k(a.data.videos),r.success(`Found ${a.data.videos.length} videos`)):r.error(a.error||"Search failed")}catch{r.error("An error occurred")}finally{K(!1)}},H=async()=>{if(!n){r.error("Pixabay API is not configured");return}R(!0);try{const a=await m.get(`/api/pixabay/search?q=${encodeURIComponent(S)}`);a.ok&&a.data?.videos?(P(a.data.videos),r.success(`Found ${a.data.videos.length} animated videos`)):r.error(a.error||"Search failed")}catch{r.error("An error occurred")}finally{R(!1)}},W=async()=>{Y(!0);try{const a=await m.get("/api/library");a.ok&&a.data?.library?.items&&j(a.data.library.items)}catch(a){console.error("Failed to load library",a)}finally{Y(!1)}};t.useEffect(()=>{o==="library"&&W()},[o]);const te=async a=>{try{const s=await m.post("/api/library/add",a);s.ok?r.success("Saved to Library!"):r.error(s.error||"Failed to save")}catch{r.error("An error occurred")}},le=async a=>{try{const s=await m.delete(`/api/library/${a}`);s.ok?(j(h=>h.filter(c=>c.id!==a)),r.success("Removed from Library")):r.error(s.error||"Failed to remove")}catch{r.error("An error occurred")}},z=async a=>{if(!i){r.error("Pexels API is not configured");return}try{r.loading(`Downloading ${a.id}...`,{id:"download"});const s=await m.post("/api/pexels/download",{id:a.id,image:a.image,previewUrl:a.previewUrl,duration:a.duration,url:a.url});s.ok&&s.data?.file?(s.data?.item&&j(h=>[s.data.item,...h.filter(d=>d.id!==s.data.item.id)]),r.success("Downloaded and saved to Library",{id:"download"})):r.error(s.error||"Download failed",{id:"download"})}catch{r.error("An error occurred",{id:"download"})}},oe=async a=>{if(!n){r.error("Pixabay API is not configured");return}try{r.loading(`Downloading ${a.id}...`,{id:"download-animated"});const s=await m.post("/api/pixabay/download",{id:a.id,image:a.image,previewUrl:a.previewUrl,duration:a.duration,url:a.url});s.ok&&s.data?.file?(s.data?.item&&j(h=>[s.data.item,...h.filter(d=>d.id!==s.data.item.id)]),r.success("Downloaded and saved to Library",{id:"download-animated"})):r.error(s.error||"Download failed",{id:"download-animated"})}catch{r.error("An error occurred",{id:"download-animated"})}},ie=async()=>{if(!$.trim()){r.error("Enter a folder path");return}try{const a=await m.post("/api/library/import-local",{folderPath:$.trim()});a.ok&&a.data?.imported?(se(a.data.imported),r.success(`Imported ${a.data.imported.length} files`)):r.error(a.error||"Import failed")}catch{r.error("An error occurred")}},G=async(a,s)=>{if(a.length===0){r.error("No results to download");return}if(!(s==="pexels"?i:n)){r.error(`${s==="pexels"?"Pexels":"Pixabay"} API is not configured`);return}const c=s==="pexels"?"/api/pexels/download":"/api/pixabay/download",d=s==="pexels"?"download-all-pexels":"download-all-pixabay";s==="pexels"&&q(!0),s==="pixabay"&&Q(!0);let A=0,E=0;try{for(let L=0;L<a.length;L++){const v=a[L];r.loading(`Downloading ${L+1}/${a.length}...`,{id:d});const N=await m.post(c,{id:v.id,image:v.image,previewUrl:v.previewUrl,duration:v.duration,url:v.url});N.ok&&N.data?.file?(A+=1,N.data?.item&&j(ne=>[N.data.item,...ne.filter(ce=>ce.id!==N.data.item.id)])):E+=1}E===0?r.success(`Downloaded ${A}/${a.length} and saved to Library`,{id:d}):A>0?r.success(`Downloaded ${A}/${a.length}. Failed: ${E}`,{id:d}):r.error("Bulk download failed",{id:d})}catch{r.error("Bulk download failed",{id:d})}finally{s==="pexels"&&q(!1),s==="pixabay"&&Q(!1)}},I=(a,s,h)=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:a.map(c=>e.jsx("div",{className:"group relative bg-white/[0.03] border border-white/10 rounded-2xl overflow-hidden hover:border-primary-500/50 transition-all duration-300",children:e.jsxs("div",{className:"aspect-[9/16] bg-black relative",children:[e.jsx(je,{video:c}),e.jsxs("div",{className:"absolute top-3 right-3 px-2 py-1 bg-black/60 backdrop-blur-md rounded-md text-[10px] font-bold text-white border border-white/10",children:[c.duration??0,"s"]}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-4 gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{onClick:()=>h(c),className:"flex-1 h-9 text-xs font-bold",children:[e.jsx(U,{size:14,className:"mr-2"}),"Download"]}),s?e.jsx(x,{onClick:()=>le(c.id),variant:"secondary",className:"h-9 px-3 bg-red-500/10 border-red-500/20 hover:bg-red-500/20 text-red-400",title:"Remove from Library",children:e.jsx(pe,{size:14})}):e.jsx(x,{onClick:()=>te(c),variant:"secondary",className:"h-9 px-3 bg-white/10 border-white/10 hover:bg-white/20",title:"Save to Library",children:e.jsx(fe,{size:14})})]}),e.jsxs("a",{href:c.url||c.previewUrl,target:"_blank",rel:"noreferrer",className:"w-full h-9 flex items-center justify-center bg-white/10 hover:bg-white/20 border border-white/10 text-white rounded-lg text-xs font-bold transition-all",children:[e.jsx(he,{size:14,className:"mr-2"}),"View Source"]})]})]})},c.id))});return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-primary-200",children:"Visual Backgrounds"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Search or browse your saved 4K/HD portrait videos."})]}),e.jsxs("div",{className:"flex flex-wrap bg-white/5 border border-white/10 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>p("search"),disabled:!i,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${o==="search"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"} ${i?"":"opacity-40 cursor-not-allowed"}`,children:[e.jsx(F,{size:14}),"Search"]}),e.jsxs("button",{onClick:()=>p("animated"),disabled:!n,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${o==="animated"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"} ${n?"":"opacity-40 cursor-not-allowed"}`,children:[e.jsx(Z,{size:14}),"Animated"]}),e.jsxs("button",{onClick:()=>p("local"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${o==="local"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"}`,children:[e.jsx(be,{size:14}),"Local Packs"]}),e.jsxs("button",{onClick:()=>p("library"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${o==="library"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"}`,children:[e.jsx(J,{size:14}),"Library"]})]})]}),o==="search"?e.jsxs(e.Fragment,{children:[!i&&e.jsx(y,{className:"bg-yellow-500/10 border-yellow-500/20 text-yellow-200 text-xs",children:"Pexels is disabled. Set `PEXELS_API_KEY` in `server/.env`."}),e.jsx(y,{className:"bg-white/5 border-white/10 backdrop-blur-xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx(B,{value:f,onChange:a=>w(a.target.value),placeholder:"e.g. moody bible, storm clouds, peaceful nature...",onKeyDown:a=>a.key==="Enter"&&X(),className:"pl-10 bg-black/20 border-white/10"})]}),e.jsx(x,{onClick:X,isLoading:M,className:"px-8",children:"Search"})]})}),g.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Results (",g.length,")"]}),e.jsxs(x,{onClick:()=>G(g,"pexels"),isLoading:ee,className:"h-8 text-[10px] uppercase tracking-tighter",children:[e.jsx(U,{size:12,className:"mr-1"}),"Download All"]})]}),I(g,!1,z)]}):!M&&e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center opacity-30",children:[e.jsx(me,{size:64,className:"text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Search for portrait videos to see results."})]})]}):o==="animated"?e.jsxs(e.Fragment,{children:[!n&&e.jsx(y,{className:"bg-yellow-500/10 border-yellow-500/20 text-yellow-200 text-xs",children:"Pixabay is disabled. Set `PIXABAY_API_KEY` in `server/.env`."}),e.jsx(y,{className:"bg-white/5 border-white/10 backdrop-blur-xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx(B,{value:S,onChange:a=>u(a.target.value),placeholder:"e.g. space, nebula, galaxy, abstract...",onKeyDown:a=>a.key==="Enter"&&H(),className:"pl-10 bg-black/20 border-white/10"})]}),e.jsx(x,{onClick:H,isLoading:_,className:"px-8",children:"Search"})]})}),b.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Animated Results (",b.length,")"]}),e.jsxs(x,{onClick:()=>G(b,"pixabay"),isLoading:ae,className:"h-8 text-[10px] uppercase tracking-tighter",children:[e.jsx(U,{size:12,className:"mr-1"}),"Download All"]})]}),I(b,!1,oe),e.jsx("div",{className:"text-xs text-gray-500 px-2",children:"Downloads use Pixabay. Make sure `PIXABAY_API_KEY` is set in `server/.env`."})]}):!_&&e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center opacity-30",children:[e.jsx(Z,{size:64,className:"text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Search for animated backgrounds to see results."})]})]}):o==="local"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(y,{className:"bg-white/5 border-white/10 backdrop-blur-xl",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{value:$,onChange:a=>re(a.target.value),placeholder:"e.g. C:\\\\videos\\\\studio-packs",className:"bg-black/20 border-white/10"}),e.jsx(x,{onClick:ie,className:"px-6",children:"Import Folder"})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2",children:"Imports .mp4/.mov/.webm/.m4v from the folder into the library and outputs."})]}),D.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Imported (",D.length,")"]}),I(D,!0,z)]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Saved Library (",C.length,")"]}),e.jsx(x,{onClick:W,variant:"secondary",className:"h-8 text-[10px] uppercase tracking-tighter",disabled:T,children:"Refresh"})]}),C.length>0?I(C,!0,z):!T&&e.jsxs(y,{className:"py-20 flex flex-col items-center justify-center opacity-30 border-dashed",children:[e.jsx(J,{size:64,className:"text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Library is empty"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2",children:"Save videos from search to build your library."})]})]})]})}export{$e as BackgroundsPage};
