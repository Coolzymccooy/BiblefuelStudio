import{c as S,f as G,r as o,j as e,B as d,b as n,z as a,I as Z}from"./index-mjygeZEm.js";import{C as x}from"./Card-B4Hd2zyq.js";import{I as N}from"./Input-BFCTMBRB.js";import{S as T}from"./sparkles-DzBt8n5G.js";import{L as B}from"./library-fx9ETTBY.js";import{P as J}from"./play-B_zQPH1v.js";import{D as W}from"./download-Bm1yLjyh.js";import{T as ee}from"./trash-2-D5syEXwr.js";import{E as re}from"./external-link-BGGwcCy_.js";const ae=[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]],se=S("bookmark",ae);const te=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}],["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"m9 13 3-3 3 3",key:"1pxg3c"}]],oe=S("folder-up",te);const ie=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],k=S("search",ie);function ue(){const{config:L}=G(),m=L.features.pexels,h=L.features.pixabay,[i,p]=o.useState("search"),[A,V]=o.useState("sunrise clouds"),[b,K]=o.useState([]),[I,M]=o.useState("space nebula"),[g,U]=o.useState([]),[P,C]=o.useState(!1),[f,y]=o.useState([]),[z,$]=o.useState(!1),[D,E]=o.useState(!1),[w,Y]=o.useState(""),[j,q]=o.useState([]),_=async()=>{if(!m){a.error("Pexels API is not configured");return}$(!0);try{const r=await n.get(`/api/pexels/search?q=${encodeURIComponent(A)}`);r.ok&&r.data?.videos?(K(r.data.videos),a.success(`Found ${r.data.videos.length} videos`)):a.error(r.error||"Search failed")}catch{a.error("An error occurred")}finally{$(!1)}},F=async()=>{if(!h){a.error("Pixabay API is not configured");return}C(!0);try{const r=await n.get(`/api/pixabay/search?q=${encodeURIComponent(I)}`);r.ok&&r.data?.videos?(U(r.data.videos),a.success(`Found ${r.data.videos.length} animated videos`)):a.error(r.error||"Search failed")}catch{a.error("An error occurred")}finally{C(!1)}},R=async()=>{E(!0);try{const r=await n.get("/api/library");r.ok&&r.data?.library?.items&&y(r.data.library.items)}catch(r){console.error("Failed to load library",r)}finally{E(!1)}};o.useEffect(()=>{i==="library"&&R()},[i]);const Q=async r=>{try{const s=await n.post("/api/library/add",r);s.ok?a.success("Saved to Library!"):a.error(s.error||"Failed to save")}catch{a.error("An error occurred")}},X=async r=>{try{const s=await n.delete(`/api/library/${r}`);s.ok?(y(c=>c.filter(t=>t.id!==r)),a.success("Removed from Library")):a.error(s.error||"Failed to remove")}catch{a.error("An error occurred")}},v=async r=>{if(!m){a.error("Pexels API is not configured");return}try{a.loading(`Downloading ${r}...`,{id:"download"});const s=await n.post("/api/pexels/download",{id:r});s.ok&&s.data?.file?(s.data?.item&&y(c=>[s.data.item,...c.filter(l=>l.id!==s.data.item.id)]),a.success("Downloaded and saved to Library",{id:"download"})):a.error(s.error||"Download failed",{id:"download"})}catch{a.error("An error occurred",{id:"download"})}},H=async r=>{if(!h){a.error("Pixabay API is not configured");return}try{a.loading(`Downloading ${r}...`,{id:"download-animated"});const s=await n.post("/api/pixabay/download",{id:r});s.ok&&s.data?.file?(s.data?.item&&y(c=>[s.data.item,...c.filter(l=>l.id!==s.data.item.id)]),a.success("Downloaded and saved to Library",{id:"download-animated"})):a.error(s.error||"Download failed",{id:"download-animated"})}catch{a.error("An error occurred",{id:"download-animated"})}},O=async()=>{if(!w.trim()){a.error("Enter a folder path");return}try{const r=await n.post("/api/library/import-local",{folderPath:w.trim()});r.ok&&r.data?.imported?(q(r.data.imported),a.success(`Imported ${r.data.imported.length} files`)):a.error(r.error||"Import failed")}catch{a.error("An error occurred")}},u=(r,s,c)=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:r.map(t=>e.jsx("div",{className:"group relative bg-white/[0.03] border border-white/10 rounded-2xl overflow-hidden hover:border-primary-500/50 transition-all duration-300",children:e.jsxs("div",{className:"aspect-[9/16] bg-black relative",children:[t.previewUrl?e.jsx("video",{src:t.previewUrl,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity",muted:!0,loop:!0,onMouseOver:l=>l.currentTarget.play(),onMouseOut:l=>{l.currentTarget.pause(),l.currentTarget.currentTime=0},poster:t.image}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-900",children:e.jsx(Z,{className:"text-gray-700",size:48})}),e.jsxs("div",{className:"absolute top-3 right-3 px-2 py-1 bg-black/60 backdrop-blur-md rounded-md text-[10px] font-bold text-white border border-white/10",children:[t.duration,"s"]}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-4 gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:()=>c(t.id),className:"flex-1 h-9 text-xs font-bold",children:[e.jsx(W,{size:14,className:"mr-2"}),"Download"]}),s?e.jsx(d,{onClick:()=>X(t.id),variant:"secondary",className:"h-9 px-3 bg-red-500/10 border-red-500/20 hover:bg-red-500/20 text-red-400",title:"Remove from Library",children:e.jsx(ee,{size:14})}):e.jsx(d,{onClick:()=>Q(t),variant:"secondary",className:"h-9 px-3 bg-white/10 border-white/10 hover:bg-white/20",title:"Save to Library",children:e.jsx(se,{size:14})})]}),e.jsxs("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"w-full h-9 flex items-center justify-center bg-white/10 hover:bg-white/20 border border-white/10 text-white rounded-lg text-xs font-bold transition-all",children:[e.jsx(re,{size:14,className:"mr-2"}),"View Source"]})]})]})},t.id))});return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-primary-200",children:"Visual Backgrounds"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Search or browse your saved 4K/HD portrait videos."})]}),e.jsxs("div",{className:"flex flex-wrap bg-white/5 border border-white/10 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>p("search"),disabled:!m,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${i==="search"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"} ${m?"":"opacity-40 cursor-not-allowed"}`,children:[e.jsx(k,{size:14}),"Search"]}),e.jsxs("button",{onClick:()=>p("animated"),disabled:!h,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${i==="animated"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"} ${h?"":"opacity-40 cursor-not-allowed"}`,children:[e.jsx(T,{size:14}),"Animated"]}),e.jsxs("button",{onClick:()=>p("local"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${i==="local"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"}`,children:[e.jsx(oe,{size:14}),"Local Packs"]}),e.jsxs("button",{onClick:()=>p("library"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${i==="library"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"}`,children:[e.jsx(B,{size:14}),"Library"]})]})]}),i==="search"?e.jsxs(e.Fragment,{children:[!m&&e.jsx(x,{className:"bg-yellow-500/10 border-yellow-500/20 text-yellow-200 text-xs",children:"Pexels is disabled. Set `PEXELS_API_KEY` in `server/.env`."}),e.jsx(x,{className:"bg-white/5 border-white/10 backdrop-blur-xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx(N,{value:A,onChange:r=>V(r.target.value),placeholder:"e.g. moody bible, storm clouds, peaceful nature...",onKeyDown:r=>r.key==="Enter"&&_(),className:"pl-10 bg-black/20 border-white/10"})]}),e.jsx(d,{onClick:_,isLoading:z,className:"px-8",children:"Search"})]})}),b.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-2",children:e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Results (",b.length,")"]})}),u(b,!1,v)]}):!z&&e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center opacity-30",children:[e.jsx(J,{size:64,className:"text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Search for portrait videos to see results."})]})]}):i==="animated"?e.jsxs(e.Fragment,{children:[!h&&e.jsx(x,{className:"bg-yellow-500/10 border-yellow-500/20 text-yellow-200 text-xs",children:"Pixabay is disabled. Set `PIXABAY_API_KEY` in `server/.env`."}),e.jsx(x,{className:"bg-white/5 border-white/10 backdrop-blur-xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx(N,{value:I,onChange:r=>M(r.target.value),placeholder:"e.g. space, nebula, galaxy, abstract...",onKeyDown:r=>r.key==="Enter"&&F(),className:"pl-10 bg-black/20 border-white/10"})]}),e.jsx(d,{onClick:F,isLoading:P,className:"px-8",children:"Search"})]})}),g.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-2",children:e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Animated Results (",g.length,")"]})}),u(g,!1,H),e.jsx("div",{className:"text-xs text-gray-500 px-2",children:"Downloads use Pixabay. Make sure `PIXABAY_API_KEY` is set in `server/.env`."})]}):!P&&e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center opacity-30",children:[e.jsx(T,{size:64,className:"text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Search for animated backgrounds to see results."})]})]}):i==="local"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(x,{className:"bg-white/5 border-white/10 backdrop-blur-xl",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{value:w,onChange:r=>Y(r.target.value),placeholder:"e.g. C:\\\\videos\\\\studio-packs",className:"bg-black/20 border-white/10"}),e.jsx(d,{onClick:O,className:"px-6",children:"Import Folder"})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2",children:"Imports .mp4/.mov/.webm/.m4v from the folder into the library and outputs."})]}),j.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Imported (",j.length,")"]}),u(j,!0,v)]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Saved Library (",f.length,")"]}),e.jsx(d,{onClick:R,variant:"secondary",className:"h-8 text-[10px] uppercase tracking-tighter",disabled:D,children:"Refresh"})]}),f.length>0?u(f,!0,v):!D&&e.jsxs(x,{className:"py-20 flex flex-col items-center justify-center opacity-30 border-dashed",children:[e.jsx(B,{size:64,className:"text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Library is empty"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2",children:"Save videos from search to build your library."})]})]})]})}export{ue as BackgroundsPage};
