import{c as $,f as Z,r as l,j as e,B as p,b as x,z as a,I as J}from"./index-BGHVPCBL.js";import{C as f}from"./Card-BE3JNlOe.js";import{I as C}from"./Input-BlLEQqKl.js";import{S as T}from"./sparkles-C1Nvxbdp.js";import{L as Y}from"./library-DE8Llasr.js";import{P as O}from"./play-qC1z5PhJ.js";import{D as ee}from"./download-CyBEVYN9.js";import{T as re}from"./trash-2-yMXcbxPn.js";import{E as ae}from"./external-link-DH8D05VJ.js";const se=[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]],te=$("bookmark",se);const oe=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}],["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"m9 13 3-3 3 3",key:"1pxg3c"}]],le=$("folder-up",oe);const ie=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],z=$("search",ie);function E(t){return String(t||"").replace(/\\/g,"/").trim()}function ne(t){return/\.(mp4|mov|webm|m4v)(\?|#|$)/i.test(String(t||""))}function ce(t){const i=E(t.previewUrl||t.url);if(!i||i.startsWith("http://")||i.startsWith("https://"))return"";const o=(i.split("/").pop()||"").replace(/\.[^.]+$/,"");return o?`/outputs/${o}.jpg`:""}function de({video:t}){const i=E(t.image),n=ce(t),o=E(t.previewUrl||t.url),d=!!o&&ne(o),[u,b]=l.useState(i||n),[g,w]=l.useState(!1),[j,m]=l.useState(!1);l.useEffect(()=>{b(i||n),w(!1),m(!1)},[t.id,i,n,t.previewUrl,t.url]);const y=()=>{if(!g&&n&&u!==n){b(n),w(!0);return}b("")};return e.jsxs("div",{className:"w-full h-full bg-black relative",onMouseEnter:()=>{d&&m(!0)},onMouseLeave:()=>m(!1),onClick:()=>{d&&m(k=>!k)},children:[u?e.jsx("img",{src:u,className:"w-full h-full object-cover opacity-85 group-hover:opacity-100 transition-opacity",alt:"",loading:"lazy",onError:y}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-900",children:e.jsx(J,{className:"text-gray-700",size:48})}),d&&j&&e.jsx("video",{src:o,className:"absolute inset-0 w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0,autoPlay:!0,preload:"metadata",onError:()=>m(!1)})]})}function we(){const{config:t}=Z(),i=t.features.pexels,n=t.features.pixabay,[o,d]=l.useState("search"),[u,b]=l.useState("sunrise clouds"),[g,w]=l.useState([]),[j,m]=l.useState("space nebula"),[y,k]=l.useState([]),[D,F]=l.useState(!1),[S,v]=l.useState([]),[_,U]=l.useState(!1),[V,R]=l.useState(!1),[I,q]=l.useState(""),[L,Q]=l.useState([]),B=async()=>{if(!i){a.error("Pexels API is not configured");return}U(!0);try{const r=await x.get(`/api/pexels/search?q=${encodeURIComponent(u)}`);r.ok&&r.data?.videos?(w(r.data.videos),a.success(`Found ${r.data.videos.length} videos`)):a.error(r.error||"Search failed")}catch{a.error("An error occurred")}finally{U(!1)}},M=async()=>{if(!n){a.error("Pixabay API is not configured");return}F(!0);try{const r=await x.get(`/api/pixabay/search?q=${encodeURIComponent(j)}`);r.ok&&r.data?.videos?(k(r.data.videos),a.success(`Found ${r.data.videos.length} animated videos`)):a.error(r.error||"Search failed")}catch{a.error("An error occurred")}finally{F(!1)}},K=async()=>{R(!0);try{const r=await x.get("/api/library");r.ok&&r.data?.library?.items&&v(r.data.library.items)}catch(r){console.error("Failed to load library",r)}finally{R(!1)}};l.useEffect(()=>{o==="library"&&K()},[o]);const X=async r=>{try{const s=await x.post("/api/library/add",r);s.ok?a.success("Saved to Library!"):a.error(s.error||"Failed to save")}catch{a.error("An error occurred")}},H=async r=>{try{const s=await x.delete(`/api/library/${r}`);s.ok?(v(h=>h.filter(c=>c.id!==r)),a.success("Removed from Library")):a.error(s.error||"Failed to remove")}catch{a.error("An error occurred")}},A=async r=>{if(!i){a.error("Pexels API is not configured");return}try{a.loading(`Downloading ${r.id}...`,{id:"download"});const s=await x.post("/api/pexels/download",{id:r.id,image:r.image,previewUrl:r.previewUrl,duration:r.duration,url:r.url});s.ok&&s.data?.file?(s.data?.item&&v(h=>[s.data.item,...h.filter(P=>P.id!==s.data.item.id)]),a.success("Downloaded and saved to Library",{id:"download"})):a.error(s.error||"Download failed",{id:"download"})}catch{a.error("An error occurred",{id:"download"})}},W=async r=>{if(!n){a.error("Pixabay API is not configured");return}try{a.loading(`Downloading ${r.id}...`,{id:"download-animated"});const s=await x.post("/api/pixabay/download",{id:r.id,image:r.image,previewUrl:r.previewUrl,duration:r.duration,url:r.url});s.ok&&s.data?.file?(s.data?.item&&v(h=>[s.data.item,...h.filter(P=>P.id!==s.data.item.id)]),a.success("Downloaded and saved to Library",{id:"download-animated"})):a.error(s.error||"Download failed",{id:"download-animated"})}catch{a.error("An error occurred",{id:"download-animated"})}},G=async()=>{if(!I.trim()){a.error("Enter a folder path");return}try{const r=await x.post("/api/library/import-local",{folderPath:I.trim()});r.ok&&r.data?.imported?(Q(r.data.imported),a.success(`Imported ${r.data.imported.length} files`)):a.error(r.error||"Import failed")}catch{a.error("An error occurred")}},N=(r,s,h)=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:r.map(c=>e.jsx("div",{className:"group relative bg-white/[0.03] border border-white/10 rounded-2xl overflow-hidden hover:border-primary-500/50 transition-all duration-300",children:e.jsxs("div",{className:"aspect-[9/16] bg-black relative",children:[e.jsx(de,{video:c}),e.jsxs("div",{className:"absolute top-3 right-3 px-2 py-1 bg-black/60 backdrop-blur-md rounded-md text-[10px] font-bold text-white border border-white/10",children:[c.duration??0,"s"]}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-4 gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:()=>h(c),className:"flex-1 h-9 text-xs font-bold",children:[e.jsx(ee,{size:14,className:"mr-2"}),"Download"]}),s?e.jsx(p,{onClick:()=>H(c.id),variant:"secondary",className:"h-9 px-3 bg-red-500/10 border-red-500/20 hover:bg-red-500/20 text-red-400",title:"Remove from Library",children:e.jsx(re,{size:14})}):e.jsx(p,{onClick:()=>X(c),variant:"secondary",className:"h-9 px-3 bg-white/10 border-white/10 hover:bg-white/20",title:"Save to Library",children:e.jsx(te,{size:14})})]}),e.jsxs("a",{href:c.url||c.previewUrl,target:"_blank",rel:"noreferrer",className:"w-full h-9 flex items-center justify-center bg-white/10 hover:bg-white/20 border border-white/10 text-white rounded-lg text-xs font-bold transition-all",children:[e.jsx(ae,{size:14,className:"mr-2"}),"View Source"]})]})]})},c.id))});return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-primary-200",children:"Visual Backgrounds"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Search or browse your saved 4K/HD portrait videos."})]}),e.jsxs("div",{className:"flex flex-wrap bg-white/5 border border-white/10 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>d("search"),disabled:!i,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${o==="search"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"} ${i?"":"opacity-40 cursor-not-allowed"}`,children:[e.jsx(z,{size:14}),"Search"]}),e.jsxs("button",{onClick:()=>d("animated"),disabled:!n,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${o==="animated"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"} ${n?"":"opacity-40 cursor-not-allowed"}`,children:[e.jsx(T,{size:14}),"Animated"]}),e.jsxs("button",{onClick:()=>d("local"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${o==="local"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"}`,children:[e.jsx(le,{size:14}),"Local Packs"]}),e.jsxs("button",{onClick:()=>d("library"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-bold transition-all ${o==="library"?"bg-primary-500 text-white shadow-lg":"text-gray-400 hover:text-white"}`,children:[e.jsx(Y,{size:14}),"Library"]})]})]}),o==="search"?e.jsxs(e.Fragment,{children:[!i&&e.jsx(f,{className:"bg-yellow-500/10 border-yellow-500/20 text-yellow-200 text-xs",children:"Pexels is disabled. Set `PEXELS_API_KEY` in `server/.env`."}),e.jsx(f,{className:"bg-white/5 border-white/10 backdrop-blur-xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx(C,{value:u,onChange:r=>b(r.target.value),placeholder:"e.g. moody bible, storm clouds, peaceful nature...",onKeyDown:r=>r.key==="Enter"&&B(),className:"pl-10 bg-black/20 border-white/10"})]}),e.jsx(p,{onClick:B,isLoading:_,className:"px-8",children:"Search"})]})}),g.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-2",children:e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Results (",g.length,")"]})}),N(g,!1,A)]}):!_&&e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center opacity-30",children:[e.jsx(O,{size:64,className:"text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Search for portrait videos to see results."})]})]}):o==="animated"?e.jsxs(e.Fragment,{children:[!n&&e.jsx(f,{className:"bg-yellow-500/10 border-yellow-500/20 text-yellow-200 text-xs",children:"Pixabay is disabled. Set `PIXABAY_API_KEY` in `server/.env`."}),e.jsx(f,{className:"bg-white/5 border-white/10 backdrop-blur-xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx(C,{value:j,onChange:r=>m(r.target.value),placeholder:"e.g. space, nebula, galaxy, abstract...",onKeyDown:r=>r.key==="Enter"&&M(),className:"pl-10 bg-black/20 border-white/10"})]}),e.jsx(p,{onClick:M,isLoading:D,className:"px-8",children:"Search"})]})}),y.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-2",children:e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Animated Results (",y.length,")"]})}),N(y,!1,W),e.jsx("div",{className:"text-xs text-gray-500 px-2",children:"Downloads use Pixabay. Make sure `PIXABAY_API_KEY` is set in `server/.env`."})]}):!D&&e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center opacity-30",children:[e.jsx(T,{size:64,className:"text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Search for animated backgrounds to see results."})]})]}):o==="local"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(f,{className:"bg-white/5 border-white/10 backdrop-blur-xl",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:I,onChange:r=>q(r.target.value),placeholder:"e.g. C:\\\\videos\\\\studio-packs",className:"bg-black/20 border-white/10"}),e.jsx(p,{onClick:G,className:"px-6",children:"Import Folder"})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2",children:"Imports .mp4/.mov/.webm/.m4v from the folder into the library and outputs."})]}),L.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Imported (",L.length,")"]}),N(L,!0,A)]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-gray-500",children:["Saved Library (",S.length,")"]}),e.jsx(p,{onClick:K,variant:"secondary",className:"h-8 text-[10px] uppercase tracking-tighter",disabled:V,children:"Refresh"})]}),S.length>0?N(S,!0,A):!V&&e.jsxs(f,{className:"py-20 flex flex-col items-center justify-center opacity-30 border-dashed",children:[e.jsx(Y,{size:64,className:"text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Library is empty"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2",children:"Save videos from search to build your library."})]})]})]})}export{we as BackgroundsPage};
