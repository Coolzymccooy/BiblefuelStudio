import{c as A,d as H,r as i,j as e,B as n,M,V as G,b as d,z as l}from"./index-CxYgDQXy.js";import{C as g}from"./Card-vEHJlAFj.js";import{D as Y}from"./download-CDHDKGXt.js";import{A as J}from"./archive-C3J9nevI.js";import{T as f}from"./trash-2-BtcKsccB.js";import{L as K}from"./layers-CwDS1M1b.js";import{L as I}from"./library-CVrf44HB.js";import{C as O}from"./circle-check-DpdJZAGN.js";const U=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],W=A("refresh-ccw",U);const X=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Z=A("trash",X);function oe(){const q=H(),[a,u]=i.useState([]),[y,b]=i.useState(!1),[j,N]=i.useState(!1),[r,h]=i.useState(new Set),[V,m]=i.useState(!1),[o,w]=i.useState(null),[$,p]=i.useState(!1),[v,D]=i.useState([]),[R,k]=i.useState(!1),[T,S]=i.useState(!1),C=async()=>{b(!0);try{const s=await d.get("/api/queue");s.ok&&s.data?.items?u(s.data.items):l.error(s.error||"Failed to load queue")}catch{l.error("An error occurred")}finally{b(!1)}};i.useEffect(()=>{C()},[]);const z=async s=>{if(confirm("Are you sure you want to delete this script?"))try{const t=await d.delete(`/api/queue/${s}`);t.ok?(u(c=>c.filter(x=>x.id!==s)),l.success("Script deleted")):l.error(t.error||"Delete failed")}catch{l.error("Failed to delete item")}},L=s=>{const t=`${s.hook}

${s.verse} (${s.reference})

${s.reflection}

${s.cta}`;localStorage.setItem("bf_tts_text",t),l.success("Script sent to Voice page!"),q("/voice-audio")},_=async()=>{if(confirm("This will wipe your entire queue. Are you absolutely sure?")){N(!0);try{(await d.post("/api/queue/clear",{})).ok&&(u([]),l.success("Queue cleared"))}catch{l.error("Failed to clear queue")}finally{N(!1)}}},E=()=>{d.download("/api/queue/export.csv")},Q=()=>{r.size===a.length?h(new Set):h(new Set(a.map(s=>s.id)))},B=s=>{const t=new Set(r);t.has(s)?t.delete(s):t.add(s),h(t)},P=async()=>{p(!0),k(!0);try{const s=await d.get("/api/library");s.ok&&s.data?.library?.items&&D(s.data.library.items)}catch{l.error("Failed to load library")}finally{k(!1)}},F=async()=>{if(!o){l.error("Please select a background first");return}S(!0);let s=0;const t=a.filter(c=>r.has(c.id));for(const c of t)try{const x=[c.title,c.hook,c.verse,c.reference,c.reflection,c.cta].slice(0,6);(await d.post("/api/jobs/enqueue",{type:"render_video",payload:{backgroundPath:o.id,lines:x,durationSec:20}})).ok&&s++}catch(x){console.error("Batch error",x)}l.success(`Enqueued ${s} render jobs!`),S(!1),m(!1),h(new Set)};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-primary-200",children:"Content Queue"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Manage and export your generated scripts batch."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full sm:w-auto",children:[r.size>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-primary-500/10 border border-primary-500/20 px-3 py-1 rounded-full animate-in fade-in zoom-in duration-300",children:[e.jsxs("span",{className:"text-[10px] font-bold text-primary-400 uppercase tracking-widest",children:[r.size," Selected"]}),e.jsx("div",{className:"w-px h-3 bg-white/10 mx-1"}),e.jsx("button",{onClick:()=>m(!0),className:"text-[10px] font-bold text-white hover:text-primary-300 uppercase underline decoration-primary-500/50",children:"Batch Render"})]}),e.jsx(n,{onClick:C,variant:"secondary",className:"bg-white/5 border-white/10 h-9 w-full sm:w-auto",disabled:y,children:e.jsx(W,{size:16,className:y?"animate-spin":""})}),e.jsxs(n,{onClick:_,variant:"secondary",className:"text-red-400 hover:text-red-300 bg-red-500/5 border-red-500/10 h-9 w-full sm:w-auto",disabled:a.length===0||j,isLoading:j,children:[e.jsx(Z,{size:16,className:"mr-2"}),"Clear All"]}),e.jsxs(n,{onClick:E,disabled:a.length===0,className:"h-9 w-full sm:w-auto",children:[e.jsx(Y,{size:16,className:"mr-2"}),"Export CSV"]})]})]}),e.jsx(g,{children:a.length===0?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center opacity-50",children:[e.jsx(J,{size:48,className:"text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Queue is empty."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Scripts you generate will appear here."})]}):e.jsxs("div",{children:[e.jsx("div",{className:"sm:hidden space-y-3",children:a.slice(0,50).map(s=>e.jsxs("div",{className:`p-4 rounded-xl border border-white/10 bg-white/[0.02] ${r.has(s.id)?"ring-1 ring-primary-500/30":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-white",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1 line-clamp-2 italic",children:['"',s.hook,'"']}),e.jsxs("div",{className:"text-[10px] text-indigo-300 mt-2",children:[s.verse," - ",s.reference]}),e.jsx("div",{className:"text-[10px] text-primary-400 mt-2 uppercase tracking-widest",children:s.cta})]}),e.jsx("input",{type:"checkbox",checked:r.has(s.id),onChange:()=>B(s.id),className:"mt-1 rounded border-white/10 bg-black/50 checked:bg-primary-500"})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsxs(n,{onClick:()=>L(s),variant:"secondary",className:"text-xs h-8",children:[e.jsx(M,{size:14,className:"mr-2"}),"Voice"]}),e.jsxs(n,{onClick:()=>z(s.id),variant:"secondary",className:"text-xs h-8 text-red-400",children:[e.jsx(f,{size:14,className:"mr-2"}),"Delete"]})]})]},s.id))}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/5 text-gray-400 uppercase text-[10px] tracking-widest font-bold",children:[e.jsx("th",{className:"py-3 px-4 w-10",children:e.jsx("input",{type:"checkbox",checked:r.size===a.length&&a.length>0,onChange:Q,className:"rounded border-white/10 bg-black/50 checked:bg-primary-500"})}),e.jsx("th",{className:"text-left py-3 px-4",children:"Script Details"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Hook & CTA"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Verse"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:a.slice(0,50).map(s=>e.jsxs("tr",{className:`group hover:bg-white/[0.02] transition-colors ${r.has(s.id)?"bg-primary-500/5":""}`,children:[e.jsx("td",{className:"py-4 px-4 w-10",children:e.jsx("input",{type:"checkbox",checked:r.has(s.id),onChange:()=>B(s.id),className:"rounded border-white/10 bg-black/50 checked:bg-primary-500"})}),e.jsxs("td",{className:"py-4 px-4 align-top max-w-xs",children:[e.jsx("div",{className:"font-semibold text-white group-hover:text-primary-300 transition-colors line-clamp-1",children:s.title}),s.createdAt&&e.jsx("div",{className:"text-[10px] text-gray-500 mt-1 font-mono",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("td",{className:"py-4 px-4 align-top text-xs text-gray-400 w-1/3",children:[e.jsxs("div",{className:"line-clamp-2 text-gray-300 italic mb-2",children:['"',s.hook,'"']}),e.jsx("div",{className:"text-[10px] text-primary-400/70 font-semibold bg-primary-500/5 inline-block px-1.5 py-0.5 rounded border border-primary-500/10 uppercase tracking-tighter",children:s.cta})]}),e.jsxs("td",{className:"py-4 px-4 align-top text-xs text-gray-400 w-1/4",children:[e.jsx("div",{className:"line-clamp-2 text-gray-400",children:s.verse}),e.jsx("span",{className:"text-indigo-400/80 font-medium text-[10px] block mt-1",children:s.reference})]}),e.jsx("td",{className:"py-4 px-4 align-top text-right",children:e.jsxs("div",{className:"flex justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>L(s),className:"p-2 text-gray-500 hover:text-primary-400 hover:bg-primary-500/10 rounded-lg transition-all",title:"Send to Voice generation",children:e.jsx(M,{size:16})}),e.jsx("button",{onClick:()=>z(s.id),className:"p-2 text-gray-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-all",title:"Remove item",children:e.jsx(f,{size:16})})]})})]},s.id))})]})}),e.jsx("div",{className:"px-4 py-3 border-t border-white/5 bg-white/[0.01]",children:e.jsxs("p",{className:"text-[10px] text-gray-600 uppercase tracking-widest font-medium",children:["Showing ",Math.min(a.length,50)," items - Auto-persisted to database"]})})]})}),V&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:()=>m(!1)}),e.jsxs(g,{className:"relative w-full max-w-md border-white/20 shadow-2xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-primary-500/20 rounded-xl",children:e.jsx(K,{size:24,className:"text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-white",children:"Batch Rendering"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.size," scripts selected for processing."]})]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsx("label",{className:"block text-[10px] uppercase tracking-widest font-bold text-gray-500",children:"Global Background"}),o?e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/10",children:[e.jsx("img",{src:o.image,className:"w-12 h-12 rounded object-cover",alt:""}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-bold text-white truncate",children:"Background Selected"}),e.jsx("div",{className:"text-[10px] text-gray-500 font-mono truncate",children:o.id})]}),e.jsx("button",{onClick:()=>w(null),className:"text-gray-500 hover:text-white",children:e.jsx(f,{size:16})})]}):e.jsxs(n,{onClick:P,variant:"secondary",className:"w-full border-dashed border-white/10 h-12 text-xs",children:[e.jsx(I,{size:16,className:"mr-2"}),"Select from Library"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{onClick:F,isLoading:T,disabled:!o,className:"flex-1",children:[e.jsx(G,{size:16,className:"mr-2"}),"Start Batch Render"]}),e.jsx(n,{onClick:()=>m(!1),variant:"secondary",children:"Cancel"})]})]})]}),$&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:()=>p(!1)}),e.jsxs(g,{className:"relative w-full max-w-4xl max-h-[80vh] overflow-hidden flex flex-col border-white/20 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsx("h3",{className:"font-bold text-lg text-white",children:"Select Batch Background"}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-500 hover:text-white",children:e.jsx(O,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:R?e.jsx("div",{className:"col-span-full py-20 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-primary-500"})}):v.length>0?v.map(s=>e.jsxs("div",{className:"group relative aspect-[9/16] bg-black rounded-xl overflow-hidden cursor-pointer hover:ring-2 hover:ring-primary-500 transition-all shadow-lg",onClick:()=>{w(s),p(!1)},children:[e.jsx("img",{src:s.image,className:"w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity",alt:""}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 p-2 bg-gradient-to-t from-black/80 to-transparent",children:e.jsxs("p",{className:"text-[10px] font-mono text-white truncate",children:["ID: ",s.id]})})]},s.id)):e.jsxs("div",{className:"col-span-full py-20 text-center opacity-30 text-white",children:[e.jsx(I,{size:48,className:"mx-auto mb-4"}),e.jsx("p",{children:"Your library is empty."})]})})]})]})]})}export{oe as QueuePage};
