import{c as z,r,j as e,B as c,z as l,F as ae,X as R,b as x}from"./index-BGHVPCBL.js";import{C as n}from"./Card-BE3JNlOe.js";import{l as A,S as g,s as te}from"./storage-DAnXyH0z.js";import{P as re}from"./play-qC1z5PhJ.js";import{D as T}from"./download-CyBEVYN9.js";import{P as le}from"./plus-DmKsYGWS.js";import{M as ie}from"./music-BvrHP_cT.js";import{T as ce}from"./trash-2-yMXcbxPn.js";import{L as U}from"./library-DE8Llasr.js";const ne=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],de=z("save",ne);const oe=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],xe=z("volume-2",oe);const me=[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]],ue=z("waves",me);function we(){const[i,m]=r.useState([]),[d,M]=r.useState(null),[$,u]=r.useState(!1),[P,B]=r.useState([]),[E,L]=r.useState(!1),[H,_]=r.useState(!1),[j,y]=r.useState(null),[p,O]=r.useState([]),[q,h]=r.useState(!1),[F,I]=r.useState(""),[v,V]=r.useState(""),[N,J]=r.useState(null),[w,Y]=r.useState(0),[k,G]=r.useState(0),[b,K]=r.useState(-14),[C,W]=r.useState(!0);r.useEffect(()=>{const s=A(g.timelineClips,[]);s.length&&m(s);const a=A(g.audioHistory,[]);a.length&&O(a);const t=A(g.audioPath,"");t&&V(t)},[]);const S=s=>{te(g.timelineClips,s)},f=(s,a)=>{if(!s.trim()){l.error("Audio path is required");return}const t={id:`clip_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,path:s,label:a,startSec:null,durationSec:null},o=[...i,t];m(o),S(o),I(""),h(!1),l.success("Clip added")},X=s=>{const a=i.filter(t=>t.id!==s);m(a),S(a)},D=(s,a)=>{const t=i.map(o=>o.id===s?{...o,...a}:o);m(t),S(t)},Q=async()=>{if(i.length===0){l.error("Timeline is empty");return}const s=l.loading("Rendering timeline audio...");try{const a=await x.post("/api/audio-adv/timeline",{clips:i.map(t=>({path:t.path,startSec:t.startSec!=null?t.startSec:void 0,durationSec:t.durationSec!=null?t.durationSec:void 0})),normalizeLUFS:b,fades:{inMs:w,outMs:k},deess:{enabled:C,amount:.55}});if(a.ok){if(l.success("Audio rendered successfully!",{id:s}),a.data?.file){const t=a.data.file.split(/[\\/]/).pop();J(`${x.baseUrl}/outputs/${t}`)}}else l.error(a.error||"Rendering failed",{id:s})}catch{l.error("An error occurred",{id:s})}},Z=async()=>{if(i.length===0){l.error("Timeline is empty");return}if(!d){l.error("Please select a background first");return}_(!0);try{const s=await x.post("/api/audio-adv/timeline-preview",{clips:i.map(a=>({path:a.path,startSec:a.startSec!=null?a.startSec:void 0,durationSec:a.durationSec!=null?a.durationSec:void 0})),backgroundPath:d.id,normalizeLUFS:b,fades:{inMs:w,outMs:k},deess:{enabled:C,amount:.55}});if(s.ok&&s.data?.file){l.success("Preview generated!");const a=s.data.file.split(/[\\/]/).pop();y(`${x.baseUrl}/outputs/${a}`)}else l.error(s.error||"Preview failed")}catch{l.error("An error occurred")}finally{_(!1)}},ee=async()=>{u(!0),L(!0);try{const s=await x.get("/api/library");s.ok&&s.data?.library?.items&&B(s.data.library.items)}catch{l.error("Failed to load library")}finally{L(!1)}},se=r.useMemo(()=>i.reduce((s,a)=>s+(a.durationSec||0),0),[i]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-primary-200",children:"Timeline Editor"}),e.jsx("p",{className:"text-gray-400",children:"Assemble and master your audio clips with precision."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 w-full sm:w-auto",children:[e.jsxs(c,{variant:"secondary",onClick:()=>l.success("Saved"),className:"w-full sm:w-auto",children:[e.jsx(de,{size:16,className:"mr-2"}),"Save Project"]}),e.jsxs(c,{onClick:Q,className:"w-full sm:w-auto",children:[e.jsx(re,{size:16,className:"mr-2"}),"Render Audio"]})]})]}),N&&e.jsx(n,{title:"Rendered Audio",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsx("audio",{controls:!0,src:N,className:"w-full"}),e.jsxs(c,{variant:"secondary",onClick:()=>window.open(N,"_blank"),className:"text-xs h-9",children:[e.jsx(T,{size:16,className:"mr-2"}),"Open"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs(n,{className:"min-h-[400px] bg-black/40 border-white/5 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(var(--primary-500-rgb),0.05),transparent)] pointer-events-none"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary-500/10 flex items-center justify-center text-primary-400",children:e.jsx(ue,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Main Assembly"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Auto-sequenced timeline"})]})]}),e.jsxs(c,{variant:"secondary",onClick:()=>h(!0),className:"h-9 px-4 text-xs",children:[e.jsx(le,{size:14,className:"mr-2"}),"Add Clip"]})]}),i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center opacity-30",children:[e.jsx(ie,{size:48,className:"mb-4"}),e.jsx("p",{className:"text-sm",children:"No clips in timeline."}),e.jsx("p",{className:"text-xs",children:"Add clips from your processed audio list."})]}):e.jsx("div",{className:"space-y-3",children:i.map((s,a)=>e.jsx("div",{className:"group relative bg-white/[0.02] border border-white/5 rounded-xl p-4 hover:border-primary-500/30 hover:bg-white/[0.04] transition-all",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-black/40 flex items-center justify-center text-xs font-bold text-gray-500",children:a+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-200 truncate",children:s.label||s.path.split("/").pop()}),e.jsx("p",{className:"text-[10px] text-gray-500 font-mono break-all",children:s.path}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsxs("label",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:["Start (sec)",e.jsx("input",{type:"number",value:s.startSec??"",onChange:t=>D(s.id,{startSec:t.target.value===""?null:Number(t.target.value)}),className:"mt-1 w-full bg-black/30 border border-white/10 rounded px-2 py-1 text-xs",min:0,step:.1})]}),e.jsxs("label",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:["Duration (sec)",e.jsx("input",{type:"number",value:s.durationSec??"",onChange:t=>D(s.id,{durationSec:t.target.value===""?null:Number(t.target.value)}),className:"mt-1 w-full bg-black/30 border border-white/10 rounded px-2 py-1 text-xs",min:0,step:.1})]})]})]})]}),e.jsx("button",{onClick:()=>X(s.id),className:"p-2 text-gray-600 hover:text-red-400 transition-colors opacity-100 sm:opacity-0 sm:group-hover:opacity-100",children:e.jsx(ce,{size:16})})]})},s.id))})]})]}),e.jsx(n,{title:"Mastering & Filters",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 p-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(xe,{size:14})," Normalize (LUFS)"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"-24",max:"-6",value:b,onChange:s=>K(Number(s.target.value)),className:"flex-1 accent-primary-500"}),e.jsx("span",{className:"text-xs font-mono w-8",children:b})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2",children:"Fade In (ms)"}),e.jsx("input",{type:"number",className:"bg-black/20 border border-white/10 rounded px-2 py-1 text-xs w-full font-mono",value:w,onChange:s=>Y(Number(s.target.value))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2",children:"Fade Out (ms)"}),e.jsx("input",{type:"number",className:"bg-black/20 border border-white/10 rounded px-2 py-1 text-xs w-full font-mono",value:k,onChange:s=>G(Number(s.target.value))})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[e.jsx("input",{type:"checkbox",id:"deess",checked:C,onChange:s=>W(s.target.checked),className:"rounded border-white/10 bg-black/50 checked:bg-primary-500"}),e.jsx("label",{htmlFor:"deess",className:"text-xs text-gray-400",children:"Enable De-esser"})]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(n,{title:"Video Background",children:e.jsx("div",{className:"p-2",children:d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"aspect-[9/16] bg-black rounded-xl overflow-hidden relative group",children:[e.jsx("video",{src:d.previewUrl||d.url,autoPlay:!0,muted:!0,loop:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:e.jsx(c,{onClick:()=>M(null),variant:"secondary",className:"bg-red-500/20 text-red-400 border-red-500/20 hover:bg-red-500/40 h-8 text-[10px]",children:"Change"})})]}),e.jsxs("div",{className:"text-[10px] font-mono text-gray-500 break-all bg-black/20 p-2 rounded",children:["ID: ",d.id]}),e.jsxs(c,{onClick:Z,isLoading:H,variant:"secondary",className:"w-full h-9 text-[10px] border-primary-500/20 text-primary-400",children:[e.jsx(ae,{size:14,className:"mr-2"}),"Preview with Background"]})]}):e.jsxs("div",{className:"py-12 border-2 border-dashed border-white/10 rounded-xl flex flex-col items-center justify-center text-center px-4",children:[e.jsx(U,{size:32,className:"text-gray-600 mb-3"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"No background selected"}),e.jsx(c,{onClick:ee,className:"w-full h-9 text-[10px]",children:"Open Library Picker"})]})})}),e.jsx(n,{title:"Stats",className:"opacity-50",children:e.jsxs("div",{className:"space-y-4 p-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Total Duration"}),e.jsxs("span",{className:"font-mono text-primary-400",children:[se.toFixed(2),"s"]})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Clips Count"}),e.jsx("span",{className:"font-mono text-primary-400",children:i.length})]})]})}),e.jsx(n,{title:"Recent Audio",children:p.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"No audio history yet."}):e.jsx("div",{className:"space-y-2",children:p.slice(0,5).map(s=>e.jsxs("div",{className:"text-xs text-gray-400 break-all",children:[e.jsx("button",{onClick:()=>f(s.path,s.kind),className:"text-primary-400 hover:text-primary-300",children:"+ Add"}),e.jsx("span",{className:"ml-2",children:s.path})]},s.id))})})]})]}),q&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:()=>h(!1)}),e.jsxs(n,{className:"relative w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col border-white/20 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsx("h3",{className:"font-bold text-lg text-white",children:"Add Clip"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-500 hover:text-white",children:e.jsx(R,{size:24})})]}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto",children:[v&&e.jsxs("div",{className:"flex items-center justify-between bg-black/30 border border-white/10 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-300 break-all",children:v}),e.jsx(c,{onClick:()=>f(v,"current"),className:"text-xs h-8",children:"Add Current"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Manual audio path"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{value:F,onChange:s=>I(s.target.value),placeholder:"e.g. server/outputs/audio.mp3",className:"flex-1 bg-black/30 border border-white/10 rounded px-3 py-2 text-sm text-gray-200"}),e.jsx(c,{onClick:()=>f(F,"manual"),className:"text-xs h-9",children:"Add"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs text-gray-400 mb-2 uppercase tracking-wider",children:"Recent Audio"}),p.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"No recent audio found."}):e.jsx("div",{className:"space-y-2",children:p.map(s=>e.jsxs("div",{className:"flex items-center gap-2 bg-black/20 border border-white/10 rounded-lg p-2",children:[e.jsx("div",{className:"flex-1 text-xs text-gray-300 break-all",children:s.path}),e.jsx(c,{onClick:()=>f(s.path,s.kind),className:"text-xs h-8",children:"Add"})]},s.id))})]})]})]})]}),$&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:()=>u(!1)}),e.jsxs(n,{className:"relative w-full max-w-4xl max-h-[80vh] overflow-hidden flex flex-col border-white/20 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsx("h3",{className:"font-bold text-lg text-white",children:"Select Background"}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-500 hover:text-white",children:e.jsx(R,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:E?e.jsx("div",{className:"col-span-full py-20 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-primary-500"})}):P.length>0?P.map(s=>e.jsxs("div",{className:"group relative aspect-[9/16] bg-black rounded-xl overflow-hidden cursor-pointer hover:ring-2 hover:ring-primary-500 transition-all shadow-lg",onClick:()=>{M(s),u(!1),l.success("Background selected")},children:[e.jsx("img",{src:s.image,className:"w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity",alt:""}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 p-2 bg-gradient-to-t from-black/80 to-transparent",children:e.jsxs("p",{className:"text-[10px] font-mono text-white truncate",children:["ID: ",s.id]})})]},s.id)):e.jsxs("div",{className:"col-span-full py-20 text-center opacity-30 text-white",children:[e.jsx(U,{size:48,className:"mx-auto mb-4"}),e.jsx("p",{children:"Your library is empty."})]})})]})]}),j&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-md",onClick:()=>y(null)}),e.jsx("div",{className:"relative w-full max-w-xl animate-in zoom-in-95 duration-200",children:e.jsxs(n,{className:"border-primary-500/30 shadow-[0_0_50px_rgba(var(--primary-500-rgb),0.3)]",children:[e.jsx("div",{className:"aspect-[9/16] bg-black rounded-xl overflow-hidden mb-4 relative",children:e.jsx("video",{src:j,controls:!0,autoPlay:!0,className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:()=>window.open(j,"_blank"),className:"flex-1",children:[e.jsx(T,{size:16,className:"mr-2"}),"Download Preview"]}),e.jsx(c,{variant:"secondary",onClick:()=>y(null),children:"Close"})]})]})})]})]})}export{we as TimelinePage};
